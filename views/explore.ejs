<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Spotly · Explore</title>

    <link rel="stylesheet" href="/css/main.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
  </head>

  <body class="page--dark">
    <!-- background lines -->
    <div class="bg-draw" aria-hidden="true">
      <svg viewBox="0 0 1440 900" preserveAspectRatio="none">
        <path
          class="draw-line yellow"
          pathLength="1000"
          style="--pathLen:1000"
          d="
            M180,-40
            C240,160 200,320 120,480
            C40,680 80,820 220,1040
          "
        />

        <path
          class="draw-line green"
          pathLength="1000"
          style="--pathLen:1000"
          d="
            M360,780
            C620,640 880,640 1160,780
          "
        />

        <path
          class="draw-line blue"
          pathLength="1000"
          style="--pathLen:1000"
          d="
            M1380,-80
            C1500,120 1500,280 1380,360
            C1260,440 1260,620 1380,700
            C1500,780 1500,960 1380,1080
          "
        />
      </svg>
    </div>

    <!-- nav bar -->
    <nav class="navbar">
      <a href="/" class="nav-left">
        <div class="logo-dot"></div>
        <span>Spotly</span>
      </a>

      <div class="nav-right">
        <a href="/explore">Explore</a>
        <a href="/spots/add">Add Spot</a>
        <a href="/spots/friends">Friends</a>
      
        <% if (isLoggedIn) { %>
          <a href="/users/profile">Profile</a>
      
          <form action="/users/logout" method="POST" style="display:inline;">
            <button class="nav-btn" type="submit">Log out</button>
          </form>
        <% } else { %>
          <a href="/users/login">Login</a>
          <a href="/users/register">Register</a>
        <% } %>
      </div>
      
    </nav>

    <!-- main -->
    <main class="explore-wrapper">
      <section class="explore-layout">
        
        <div class="map-panel">
          
          <form action="/explore" method="GET" class="map-topbar">
            <input
              id="spotSearch"
              type="text"
              name="vibe"
              placeholder="Search vibe (e.g. chill, party, study)..."
              value="<%= vibe || '' %>"
              autocomplete="off"
            />
            <button type="submit" class="change-vibe-btn">Change vibe</button>
          </form>

          <div class="map-area">
            <div id="explore-map"></div>
          </div>
        </div>

        
        <aside class="right-sidebar">
          <% if (!spots || spots.length === 0) { %>
            <div class="side-card">
              <div class="title">No spots found</div>
              <div class="meta">Try another vibe (e.g. chill)</div>
            </div>
          <% } %>

          <% (spots || []).forEach((s) => { %>
            <button
              type="button"
              class="side-card side-card-btn"
              data-spot-id="<%= s._id %>"
              data-spot-title="<%= (s.title || '').replace(/"/g, '&quot;') %>"
              data-spot-location="<%= (s.locationName || '').replace(/"/g, '&quot;') %>"
              data-spot-tags="<%= (s.vibeTags || []).join(',').replace(/"/g, '&quot;') %>"
            >
              <div class="title"><%= s.title || "Untitled spot" %></div>
              <div class="meta"><%= (s.vibeTags && s.vibeTags.length) ? s.vibeTags.join(" • ") : "No vibe tags" %></div>
              <div class="time"><%= s.locationName || "" %></div>
            </button>
          <% }) %>
        </aside>
      </section>
    </main>

    <footer class="footer-basic">
      <div>Spotly — Discover the vibe. Share your world.</div>
      <div class="dim">© <%= new Date().getFullYear() %> Anri</div>
    </footer>

    
    <script>
      window.__SPOTS__ = <%- JSON.stringify(spots || []) %>;
    </script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/js/explore.js"></script>
  </body>
</html>
